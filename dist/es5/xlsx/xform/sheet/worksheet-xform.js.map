{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"names":["_","require","utils","XmlStream","RelType","Enums","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","RowBreaksXform","WorkSheetXform","module","exports","options","maxRows","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","printOptions","picture","drawing","inherits","WORKSHEET_ATTRIBUTES","xmlns","prepare","model","merges","formulae","siFormulae","rows","rels","nextRid","r","length","rId","address","hyperlink","mode","push","Id","Type","Hyperlink","Target","target","TargetMode","display","type","ValueType","Formula","result","Error","error","location","drawingRelsHash","bookImage","media","forEach","medium","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","range","render","xmlStream","openXml","StdDocAttributes","openNode","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","undefined","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","dimensions","views","closeNode","parseOpen","node","parser","each","xform","reset","parseText","text","parseClose","outlinePropertiesx","sheetProperties","Object","assign","reconcile","relationships","reduce","h","rel","filter","Boolean","row","cells","drawingRel","match","drawingName","anchor","index","backgroundRel","split","mediaIndex"],"mappings":"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","file":"worksheet-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2016 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar _ = require('../../../utils/under-dash');\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar XmlStream = require('../../../utils/xml-stream');\r\n\r\nvar RelType = require('../../rel-type');\r\nvar Enums = require('../../../doc/enums');\r\n\r\nvar Merges = require('./merges');\r\n\r\nvar BaseXform = require('../base-xform');\r\nvar ListXform = require('../list-xform');\r\nvar RowXform = require('./row-xform');\r\nvar ColXform = require('./col-xform');\r\nvar DimensionXform = require('./dimension-xform');\r\nvar HyperlinkXform = require('./hyperlink-xform');\r\nvar MergeCellXform = require('./merge-cell-xform');\r\nvar DataValidationsXform = require('./data-validations-xform');\r\nvar SheetPropertiesXform = require('./sheet-properties-xform');\r\nvar SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\r\nvar SheetViewXform = require('./sheet-view-xform');\r\nvar PageMarginsXform = require('./page-margins-xform');\r\nvar PageSetupXform = require('./page-setup-xform');\r\nvar PrintOptionsXform = require('./print-options-xform');\r\nvar AutoFilterXform = require('./auto-filter-xform');\r\nvar PictureXform = require('./picture-xform');\r\nvar DrawingXform = require('./drawing-xform');\r\nvar RowBreaksXform = require('./row-breaks-xform');\r\n\r\nvar WorkSheetXform = module.exports = function(options) {\r\n  var maxRows = options && options.maxRows;\r\n  this.map = {\r\n    sheetPr: new SheetPropertiesXform(),\r\n    dimension: new DimensionXform(),\r\n    sheetViews: new ListXform({tag: 'sheetViews', count: false, childXform: new SheetViewXform()}),\r\n    sheetFormatPr: new SheetFormatPropertiesXform(),\r\n    cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\r\n    sheetData: new ListXform({tag: 'sheetData', count: false, empty: true, childXform: new RowXform(), maxItems: maxRows}),\r\n    autoFilter: new AutoFilterXform(),\r\n    mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\r\n    rowBreaks: new RowBreaksXform(),\r\n    hyperlinks: new ListXform({tag: 'hyperlinks', count: false, childXform: new HyperlinkXform()}),\r\n    pageMargins: new PageMarginsXform(),\r\n    dataValidations: new DataValidationsXform(),\r\n    pageSetup: new PageSetupXform(),\r\n    printOptions: new PrintOptionsXform(),\r\n    picture: new PictureXform(),\r\n    drawing: new DrawingXform(),\r\n  };\r\n};\r\n\r\nutils.inherits(WorkSheetXform, BaseXform, {\r\n  WORKSHEET_ATTRIBUTES: {\r\n    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n    'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n    'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n    'mc:Ignorable': 'x14ac',\r\n    'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac'\r\n  }\r\n}, {\r\n  prepare: function(model, options) {\r\n    options.merges = new Merges();\r\n    options.hyperlinks = model.hyperlinks;\r\n    var hyperlinks = model.hyperlinks = [];\r\n\r\n    options.formulae = {};\r\n    options.siFormulae = 0;\r\n    this.map.cols.prepare(model.cols, options);\r\n    this.map.sheetData.prepare(model.rows, options);\r\n\r\n    model.mergeCells = options.merges.mergeCells;\r\n\r\n    // prepare relationships\r\n    var rels = model.rels = [];\r\n    function nextRid(r) { return 'rId' + (r.length + 1); }\r\n    var rId;\r\n    for (const address in options.hyperlinks) {\r\n      var hyperlink = options.hyperlinks[address];\r\n      if (hyperlink.mode === 'external') {\r\n        rId = nextRid(rels);\r\n        hyperlink.rId = rId;\r\n        rels.push({\r\n          Id: rId,\r\n          Type: RelType.Hyperlink,\r\n          Target: hyperlink.target,\r\n          TargetMode: 'External'\r\n        });\r\n        hyperlinks.push({\r\n          rId: rId,\r\n          address: address\r\n        });\r\n      } else {\r\n        // re-evaluate display\r\n        var display;\r\n        if (model.type === Enums.ValueType.Formula) {\r\n          display = model.result;\r\n        } else if (model.type === Enums.ValueType.Error) {\r\n          display = model.result.error;\r\n        } else {\r\n          display = model.result;\r\n        }\r\n        hyperlinks.push({\r\n          address: address,\r\n          location: hyperlink.target,\r\n          display: display,\r\n        });\r\n        hyperlink.display = display;\r\n      }\r\n    }\r\n\r\n    var drawingRelsHash = [];\r\n    var bookImage;\r\n    model.media.forEach(function(medium) {\r\n      if (medium.type === 'background') {\r\n        rId = nextRid(rels);\r\n        bookImage = options.media[medium.imageId];\r\n        rels.push({\r\n          Id: rId,\r\n          Type: RelType.Image,\r\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n        });\r\n        model.background = {\r\n          rId,\r\n        };\r\n        model.image = options.media[medium.imageId];\r\n      } else if (medium.type === 'image') {\r\n        var drawing = model.drawing;\r\n        bookImage = options.media[medium.imageId];\r\n        if (!drawing) {\r\n          drawing = model.drawing = {\r\n            rId: nextRid(rels),\r\n            name: 'drawing' + (++options.drawingsCount),\r\n            anchors: [],\r\n            rels: [],\r\n          };\r\n          options.drawings.push(drawing);\r\n          rels.push({\r\n            Id: drawing.rId,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\r\n            Target: '../drawings/' + drawing.name + '.xml',\r\n          });\r\n        }\r\n        var rIdImage = drawingRelsHash[medium.imageId];\r\n        if (!rIdImage) {\r\n          rIdImage = nextRid(drawing.rels);\r\n          drawingRelsHash[medium.imageId] = rIdImage;\r\n          drawing.rels.push({\r\n            Id: rIdImage,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\r\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n          });\r\n        }\r\n        drawing.anchors.push({\r\n          picture: {\r\n            rId: rIdImage,\r\n          },\r\n          range: medium.range,\r\n        });\r\n      }\r\n    });\r\n  },\r\n\r\n  render: function(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\r\n\r\n    var sheetFormatPropertiesModel = model.properties ? {\r\n      defaultRowHeight: model.properties.defaultRowHeight,\r\n      dyDescent: model.properties.dyDescent,\r\n      outlineLevelCol: model.properties.outlineLevelCol,\r\n      outlineLevelRow: model.properties.outlineLevelRow\r\n    } : undefined;\r\n    var sheetPropertiesModel = {\r\n      outlineProperties: model.properties && model.properties.outlineProperties,\r\n      tabColor: model.properties && model.properties.tabColor,\r\n      pageSetup: model.pageSetup && model.pageSetup.fitToPage ? {\r\n        fitToPage: model.pageSetup.fitToPage\r\n      } : undefined\r\n    };\r\n    var pageMarginsModel = model.pageSetup && model.pageSetup.margins;\r\n    var printOptionsModel = {\r\n      showRowColHeaders: model.showRowColHeaders,\r\n      showGridLines: model.showGridLines,\r\n      horizontalCentered: model.horizontalCentered,\r\n      verticalCentered: model.verticalCentered\r\n    };\r\n\r\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\r\n    this.map.dimension.render(xmlStream, model.dimensions);\r\n    this.map.sheetViews.render(xmlStream, model.views);\r\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\r\n    this.map.cols.render(xmlStream, model.cols);\r\n    this.map.sheetData.render(xmlStream, model.rows);\r\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\r\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\r\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\r\n    // For some reason hyperlinks have to be after the data validations\r\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\r\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\r\n    this.map.printOptions.render(xmlStream, printOptionsModel);\r\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\r\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\r\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\r\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\r\n\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n\r\n    if (node.name === 'worksheet') {\r\n      _.each(this.map, function(xform) {\r\n        xform.reset();\r\n      });\r\n      return true;\r\n    }\r\n\r\n    this.parser = this.map[node.name];\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n    }\r\n    return true;\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'worksheet':\r\n        var properties = this.map.sheetFormatPr.model;\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\r\n          properties.tabColor = this.map.sheetPr.model.tabColor;\r\n        }\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\r\n            properties.outlineProperties = this.map.sheetPr.model.outlinePropertiesx;\r\n        }\r\n        var sheetProperties = {\r\n          fitToPage: (this.map.sheetPr.model && this.map.sheetPr.model.pageSetup && this.map.sheetPr.model.pageSetup.fitToPage) || false,\r\n          margins: this.map.pageMargins.model\r\n        };\r\n        var pageSetup = Object.assign(\r\n          sheetProperties,\r\n          this.map.pageSetup.model,\r\n          this.map.printOptions.model\r\n        );\r\n        this.model = {\r\n          dimensions: this.map.dimension.model,\r\n          cols: this.map.cols.model,\r\n          rows: this.map.sheetData.model,\r\n          mergeCells: this.map.mergeCells.model,\r\n          hyperlinks: this.map.hyperlinks.model,\r\n          dataValidations: this.map.dataValidations.model,\r\n          properties: properties,\r\n          views: this.map.sheetViews.model,\r\n          pageSetup: pageSetup,\r\n          background: this.map.picture.model,\r\n          drawing: this.map.drawing.model,\r\n        };\r\n\r\n        if (this.map.autoFilter.model) {\r\n          this.model.autoFilter = this.map.autoFilter.model;\r\n        }\r\n        return false;\r\n      default:\r\n        // not quite sure how we get here!\r\n        return true;\r\n    }\r\n  },\r\n\r\n  reconcile: function(model, options) {\r\n    // options.merges = new Merges();\r\n    // options.merges.reconcile(model.mergeCells, model.rows);\r\n    var rels = (model.relationships || []).reduce(function(h, rel) {\r\n      h[rel.Id] = rel;\r\n      return h;\r\n    }, {});\r\n    model.hyperlinks = (model.hyperlinks || []).reduce(function(h, hyperlink) {\r\n      if (hyperlink.rId) {\r\n        h[hyperlink.address] = {target: rels[hyperlink.rId].Target, mode: 'external'};\r\n      } else if (hyperlink.location) {\r\n        h[hyperlink.address] = {target: hyperlink.location, display: hyperlink.display, mode: 'internal'};\r\n      }\r\n      return h;\r\n    }, {});\r\n\r\n    options.formulae = {};\r\n\r\n    // compact the rows and cells\r\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\r\n    model.rows.forEach(function(row) {\r\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\r\n    });\r\n\r\n    this.map.cols.reconcile(model.cols, options);\r\n    this.map.sheetData.reconcile(model.rows, options);\r\n\r\n    model.media = [];\r\n    if (model.drawing) {\r\n      var drawingRel = rels[model.drawing.rId];\r\n      var match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\r\n      if (match) {\r\n        var drawingName = match[1];\r\n        var drawing = options.drawings[drawingName];\r\n        drawing.anchors.forEach(anchor => {\r\n          if (anchor.medium) {\r\n            var image = {\r\n              type: 'image',\r\n              imageId: anchor.medium.index,\r\n              range: anchor.range,\r\n            };\r\n            model.media.push(image);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    var backgroundRel = model.background && rels[model.background.rId];\r\n    if (backgroundRel) {\r\n      var target = backgroundRel.Target.split('/media/')[1];\r\n      var imageId = options.mediaIndex && options.mediaIndex[target];\r\n      if (imageId !== undefined) {\r\n        model.media.push({\r\n          type: 'background',\r\n          imageId,\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n    delete model.relationships;\r\n  }\r\n});\r\n\r\n"]}